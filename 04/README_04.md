---
marp: true
paginate: true
theme: custom
------

<!-- _class: cover -->

<h1 class="logo">ART_OF_<b>CODE</b> #4</h1>
<p class="title">p5.js で学ぶ JavaScript #4</p>
<p class="author">&copy; 2022 Satoshi Soma</p>

---

## 前回のおさらい 1/2

### 条件分岐（ `if` 文 ）
ある**特定の条件**を満たした場合にのみ実行させたい処理がある場合、
`if` 文で条件分岐を行う。

```js
if (条件式) {
  // 実行内容
}
```

`()` 内に書かれた `条件式` が **正しい** なら `{ }` 内のコードが実行される。
逆に、`条件式` が **正しくない** のなら `{ }` 内は実行されない。

---

### 真偽値
条件式が「正しい」状態を **真 (true)** と呼ぶ。
逆に、「正しくない」状態は **偽 (false)** と呼ぶ。
そして、これら二つの状態をまとめて **真偽値 (Boolean)** と呼ぶ。

---

#### 条件式の記述例
```js
if (x < y) {  }  // x が y よりも小さければ 真
if (x > y) {  }  // x が y よりも大きければ 真
```

`=（イコール）` 記号を含む条件式:

```js
if (x == y) {  }  // x が y と等しければ 真
if (x != y) {  }  // x が y と等しくなければ 真
if (x <= y) {  }  // x が y 以下なら 真
if (x >= y) {  }  // x が y 以上なら 真
```

---

ちなみに条件式の判定結果<small>（真偽値）</small>を **変数に保存** することも可能。

```js
// 変数:cond に x < y の真偽値を保存
let cond = x < y;

 // 変数:cond を if 文の条件として使う
if (cond) {
  alert('x は y より小さい。');
}
```

---

## 前回のおさらい 2/2

### ループ処理（ `for` 文 ）
同じ処理を一定の回数分だけ **繰り返し実行** させたい場合は `for` 文を使う。
仮に、`alert` 関数を 5 回繰り返す場合は以下のような記述になる。

```js
for (let i = 0; i < 5; i++) {
  alert(i + '回目'); // '0回目', '1回目', '2回目' ...
}
```

変数 `i` は **ループカウンター** と呼び、**`{ }` 内が実行される度に `+1`** される。
そして、`i` が `5` になると `for` 文は終了する。

---

### `for` 文の動作原理
```js
// 例: 100 回ループさせる場合
for (let i = 0; i < 100; i++) {
  （省略）
}
```

`( )` の中身は `;`<small>（セミコロン）</small>を挟んで、以下の **3 つのパート** に分けられる。

```js
let i = 0  // 左: 最初に一回だけ実行される
```

```js
i < 100    // 中央: { } 内を実行するか否かの条件式
```

```js
i++        // 右: ループ毎に実行される
```

---

まとめるとこうなる。
| 実行順 | 内容 |
|:---:|:----|
| 1. | `for` の行に到達 |
| 2. | <small>左のパート:</small> ループカウンタの宣言 |
| 3. | <small>中央パート:</small> 条件判定（条件が 真 でなければ `for` 文を終了する） |
| 4. | `{ }` 内のコードの実行 |
| 5. | <small>右のパート:</small> ループカウンタに +1 |
| 6. | 3. に戻る |

---

# 高度な条件分岐

---

### `else` 句
`if` 文を使い条件分岐が行えることを学んだ。
`if` 文の直後に **`else`** 句を付帯させると、
逆に、**条件に合致しなかった場合** に実行させるコードを記述することができる。

---

### `else` 句の書き方<small>（例）</small>
```js
if (x < y) {
  // 真 の場合
  alert('X は Y より小さい。');

} else {
  // 偽 の場合
  alert('X は Y より小さくない。');
}
```

上記のコードは、
`x < y` が *真 (true)* なら上の `alert` が実行され、
`x < y` が *偽 (false)* なら下の `alert` が実行される。

---

`else` 句は、必ず **`if` 文の直後に付帯**するもので、
**`else` 句単体で記述することはできない**。

```js
// これは構文エラー
else {

}
```
```js
// これは OK
if (a == b) {

} else {

}
```

---

### `else if` 句
`else if` 句で、**さらに条件分岐を追加** することもできる。

```js
if (x < y) {
  alert('X は Y より小さい。');

} else if (x > z) {
  alert('X は Y より小さくない。');
  alert('X は Z より大きい。');
}
```

この場合、最初の `if` が *偽 (false)* の時のみ、
`else if` の条件判定が行われる。

どちらの条件にも合致しなかった場合は、何も実行されない。

---

複数の `else if` を繋げて、
**3つ以上の条件分岐** をつくることも可能。
```js
if (pet == 'dog') {          // 分岐:1
  alert('🐶 ワン');

} else if (pet == 'cat') {   // 分岐:2
  alert('🐱 ニャー');

} else if (pet == 'mouse') { // 分岐:3
  alert('🐭 チュー');

} else { // いずれの条件も満たさなかった場合
  alert('❓❓❓');
}
```

サンプルスケッチで確認してみよう。
https://editor.p5js.org/amekusa/sketches/3YAjHkOI-

---

## `while` ループ

---

`for` 文を使うことによって、
同じ処理を繰り返し実行させるコードの書き方を学んだが、
ループを実現させる方法は他にもある。

---

`for` 文は、**決められた回数分** だけループさせたい場合に有用だが、
時には、何回ループさせるべきかを **正確には定められない**,
あるいは **定めたくない** というケースもあるだろう。

そのような場合に有用なのが **`while`** ループだ。

---

### 書き方:

```js
while (条件) {
    // 実行内容
}
```

書式は **`if` 文とよく似ている**。
**`条件`** には `if` 文で使用するのと同じ **条件式** が入る。
条件式が *真 (true)* の場合のみ `{ }` 内が実行されるのも `if` 文と同じである。

`if` 文と違う点は、
**条件が満たされている限り、`{ }` が繰り返し実行され続ける** というものだ。

---

```js
let i = 0
while (i < 3) {
    alert(i);
}
```

例えばこのコードは、一度実行されると
**ブラウザのタブを閉じるか、ブラウザを終了**させるまで
永遠に `alert(0)` を実行し続ける、文字通りの **無限ループ** となる。

（ただし最近のブラウザは無限ループを検出し、コードの実行を自動的に中断するなどのセーフティ機能が備わっている。）

---

実際に実行して動作を確認してみよう。

p5.js エディターで無限ループを実行するには、最初の行に
```js
// noprotect
```
と記述し、セーフティ機能を外す必要がある。

---

一般的に、**無限ループは望ましいものではない**。

どんな方法にせよ、外的な力によって**プログラムを強制的に止める**しかなくなってしまうからだ。それはユーザーに不便を強いることになってしまうし、
何よりプログラムの終わり方として美しい形とは言えない。

**完成されたプログラムとは、自らの終わり方まで完璧に記述されているというものだ。**

---

では `while` ループを終了させるにはどうしたらよいだろう。
方法は二つある。

一つは、**ループの実行条件が成立しない状態**にすればよい。

---

```js
let i = 0
while (i < 3) {
    alert(i);
    i++; // i に +1
}
```

先ほどの無限ループに 1 行書き加えてみた。
**`++`** は **インクリメント** といい、**変数に 1 加える** 役割をもつ演算子だ。

```js
i = i + 1;
```

このように書くのと同じ意味を持つ。

---

これも実際に実行して動作を確認してみてほしい。

`{ }` 内が実行される度に、変数 `i` がインクリメントされ、
**3 度目の実行で `i` は `3` となる**。

それによって **条件式 `i < 3` は 偽 (false) となる**。
つまりループの実行条件が**成立しない状態となった**ため、
この `while` ループは **3 度目で終了する**。

---

### `break`
`while` を終了させるもう一つの方法は、**`break` 文を用いることだ**。

```js
let i = 0;
while (i < 3) {
    alert(i);
    break; // ループはここで終了する
}
```

`while` ループ実行中に **`break;`** と記述された行に到達すると、
その `while` ループは **即座に終了する**。

たとえループの実行条件が成立していようとも、**問答無用でループを抜ける**。

---

`while` ループ内の **`if` 文の中に `break` 文を書く**ことで、
**特定の条件に達したらループを抜ける** というような処理を実現させることができる。

```js
while (true) {
    let dice = round(random(1, 6)); // サイコロを振る
    alert('出目は' + dice);

    // 出目が 4 以上ならループを抜ける
    if (dice >= 4) {
        break;
    }
}
```

**`true`** は **真** の値を表す。ゆえに `while (true)` は **必ず無限ループになる**。
しかし `if` 文を用い、
**適切な条件で `break` 文が実行される**ようにプログラムしておけば問題ない。

---

サンプルコード:
https://editor.p5js.org/amekusa/sketches/fThVmGvza

---

## オブジェクト (object)
プロパティで表現される、バーチャルな “モノ”

---

“モノ” は**単一の数値**では表現できない。
どんなに単純な物体でも
色, 形, 大きさ, 重さ
といった、**複数の様々な情報から成り立っている**。

![bg left:35% 75%](apple.png)

---

そのような “モノ” を JavaScript で表現するには
**オブジェクト (object)** というデータ型を用いる。

（データ型とは、数値や文字列といった値のタイプ（種類）のこと。）

---

オブジェクトは **1つ以上の属性（プロパティ）** から構成されており、
このような書式で定義することができる。

```js
{
    プロパティA: 値,
    プロパティB: 値,
    プロパティC: 値
}
```

もちろんプロパティ名は自由に決めてよい。

---

例として :apple: をオブジェクトとして定義してみよう。

```js
let apple = {
    color:  'red', // 色
    size:   11,    // cm
    weight: 474.9  // グラム
};
```

`color`, `size`, `weight` という**三つのプロパティで構成されるオブジェクト**を定義し、
それを変数 `apple` に代入している。

---

ゲームのキャラならこういう感じ（？）。

```js
let player = {
    name: 'John',  // 名前
    sex:  'male',  // 性別

    lv:      1,    // レベル
    exp:     0,    // 経験値

    hp:    128,    // 体力
    str:     9,    // ちから
    agl:     3,    // 素早さ
    fth:    12,    // 信仰心

    wpn:  'gun'    // 武器
};
```

![bg right:40%](knight.png)

---

オブジェクトのプロパティにアクセスするには、

```js
alert('ようこそ！ ' + player.name + 'さん'); // 'ようこそ！ Johnさん'
```

このように、`変数.プロパティ名` と書けばよい。

---

また、プロパティは変数と同様に **いつでも値を変更**することが可能だ。

```js
player.lv++; // レベルアップ
```

```js
let dmg = 256;
player.hp = player.hp - dmg; // プレイヤーに 256 のダメージ
```

---

条件分岐に利用する等、変数とほぼ同じように使うことができる。

```js
if (player.hp <= 0) {  // 体力 0 以下
    alert('YOU DIED'); // ゲームオーバー
}
```

---

また、プロパティは**後から追加**しても問題ない。

```js
let obj = {};  // 空のオブジェクトを作成
obj.abc = 123; // プロパティ abc を追加
obj.def = 456; // プロパティ def を追加
```

---

サンプルスケッチを確認してみよう。
`04/balls.js` https://editor.p5js.org/amekusa/sketches/UulZcFAl-


改造版:
`04/bouncy-balls.js` https://editor.p5js.org/amekusa/sketches/_AV0PDuJr

---

### 演習:
サンプルスケッチをコピーし、
改造して面白い動きをつけてみよう。

---

## 配列 (array)

---

第二回目の講義で、
変数は **「値を一つだけ保存できる容れ物」** のようなものだと説明した。

先ほどのサンプルスケッチ内の**変数 `ballA`, `ballB`** のように、
**2 個のオブジェクトが必要なら 2 つの変数**を用意する必要がある。

---

もし同じ方法で **3 個目のボール**が欲しくなったら、
我々はさらに **変数 `ballC`** を用意しなくてはならない。

だが ***“Do Not Repeat Yourself”*** の原則に立ち返るならば、
これは美しい解決方法とは言えない。

そこで **配列 (array)** の出番となる。

---

JavaScript における配列とは **特殊なオブジェクトの一種**で、
**複数の値を、それぞれに番号を振って格納, 管理**することのできる構造体である。

---

配列を定義するには、

```js
[値A, 値B, 値C]
```

このように `[ ]` の中に **`,（カンマ）` 区切り**で値を列挙する。

```js
let list = ['Alice', 'Bob', 'Charles'];
```

この例では、**変数 `list`** に
**三つの文字列 `Alice`, `Bob`, `Charles` が入った配列** を代入している。

---

配列に格納されている一つ一つの値を **要素 (element)** と呼び、
**番号を指定** してそれぞれの要素にアクセスすることができる。

```js
alert( list[0] ); // "Alice"
alert( list[1] ); // "Bob"
alert( list[2] ); // "Charles"
```

`[ ]` の数字が番号で、**`0` から始まる連番**となっている。
この番号は **添字（インデックス）** と呼ぶ。

---

ちなみに、値の列挙時に改行を挟んでも問題ない。
長い配列を定義する際は**読みやすさ**を心がけよう。

```js
// NATO フォネティックコード
let codes = [
    'Alfa',
    'Bravo',
    'Charlie',

    'Delta',
    'Echo',
    'Foxtrot'
];
```

---

また、配列に**後から要素を追加**することも可能だ。
**`push()` 関数**を使うと、**配列の最後尾**に新しい要素を追加できる。

```js
codes.push('Golf'); // Foxtrot の次
```

---

### 配列をループで回そう
ここまで内容では配列の利点がこれといって思いつかないかもしれないが、
**添字で個々の要素にアクセスできる**という性質が
**`for` ループ**と組み合わせた時に**真価**を発揮する。

---

サンプルコードを確認しよう。
`04/array.js` https://editor.p5js.org/amekusa/sketches/_Y5ai80fH

---

早速、配列と `for` ループを駆使し、
2 個だったボールを **24 個** に増やしてみた。
コードと動作を確認してみてほしい。
`04/bouncy-balls-2.js` https://editor.p5js.org/amekusa/sketches/FIM3H8feO

---

## 演習:
サンプルコードを参考にしながら、
- オブジェクト (object)
- 配列 (array)
- `for` ループ

を駆使し、**動くアート**を作ってみよう。

---

参考書籍のコード
http://www.bnn.co.jp/support/generativedesign_p5js/

